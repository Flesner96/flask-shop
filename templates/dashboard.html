{% extends "layout.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1 class="text-xl font-bold mb-4">Dashboard</h1>

<div class="grid grid-cols-3 gap-4 mb-6">
  <div class="bg-blue-100 p-4 rounded">ðŸ›’ Products: {{ product_count }}</div>
  <div class="bg-green-100 p-4 rounded">ðŸ‘¤ Clients: {{ client_count }}</div>
  <div class="bg-yellow-100 p-4 rounded">ðŸ“¦ Orders: {{ order_count }}</div>
</div>

<div class="grid grid-cols-2 gap-4 my-6">
  <div class="bg-white border rounded p-4">
    <h2 class="font-bold text-lg mb-2">Latest Product Added</h2>
    {% if latest_product %}
      <p><strong>Name:</strong> {{ latest_product[1] }}</p>
      <p><strong>Price:</strong> ${{ latest_product[2] }}</p>
      <p><strong>Rating:</strong> {{ latest_product[3] }}</p>
      <p><strong>Added:</strong> {{ latest_product[4] }}</p>
    {% else %}
      <p>No products found.</p>
    {% endif %}
  </div>

  <div class="bg-white border rounded p-4">
    <h2 class="font-bold text-lg mb-2">Best Rated Product</h2>
    {% if best_product %}
      <p><strong>Name:</strong> {{ best_product[1] }}</p>
      <p><strong>Price:</strong> ${{ best_product[2] }}</p>
      <p><strong>Rating:</strong> {{ best_product[3] }}</p>
    {% else %}
      <p>No products found.</p>
    {% endif %}
  </div>
</div>

<h2 class="text-lg font-semibold mb-2">Recent Orders</h2>
<table class="min-w-full bg-white border">
  <thead class="bg-gray-100">
    <tr>
      <th class="px-4 py-2">ID</th>
      <th class="px-4 py-2">Client</th>
      <th class="px-4 py-2">Details</th>
      <th class="px-4 py-2">Date</th>
    </tr>
  </thead>
  <tbody>
    {% for o in recent_orders %}
    <tr class="border-t">
      <td class="px-4 py-2">{{ o[0] }}</td>
      <td class="px-4 py-2">{{ o[2] }} {{ o[3] }}</td>
      <td class="px-4 py-2">{{ o[4] }}</td>
      <td class="px-4 py-2">{{ o[5] }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-10">
  <div class="bg-white border p-4 rounded shadow">
    <h2 class="font-semibold text-lg mb-2">ðŸ“ˆ Orders Per Day</h2>
    <canvas id="ordersChart"></canvas>
  </div>

  <div class="bg-white border p-4 rounded shadow">
    <h2 class="font-semibold text-lg mb-2">ðŸ‘¤ Top Clients by Orders</h2>
    <canvas id="clientsChart"></canvas>
  </div>
</div>
<script>
  const ordersLabels = {{ orders_per_day | map(attribute=0) | list | tojson }};
  const ordersCounts = {{ orders_per_day | map(attribute=1) | list | tojson }};

  const clientsLabels = {{ top_clients | map(attribute=0) | list | tojson }};
  const clientsCounts = {{ top_clients | map(attribute=1) | list | tojson }};

  new Chart(document.getElementById('ordersChart'), {
    type: 'bar',
    data: {
      labels: ordersLabels,
      datasets: [{
        label: 'Orders per Day',
        data: ordersCounts,
        backgroundColor: 'rgba(59, 130, 246, 0.6)', // Tailwind blue-500
        borderColor: 'rgba(59, 130, 246, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } }
    }
  });

  new Chart(document.getElementById('clientsChart'), {
    type: 'bar',
    data: {
      labels: clientsLabels,
      datasets: [{
        label: 'Order Count',
        data: clientsCounts,
        backgroundColor: 'rgba(16, 185, 129, 0.6)', // Tailwind green-500
        borderColor: 'rgba(16, 185, 129, 1)',
        borderWidth: 1
      }]
    },
    options: {
      indexAxis: 'y', // Horizontal bars
      scales: { x: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
